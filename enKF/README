Run enKF.sh to start the data assimilation. You need the following files:

----------
SETTING FILE
----------
Must contain these lines:
- Name of the bas-file with the bas extension;
- Name of a list-file containing the names of the skel-files used to make the
  str-files for the ensemble simulations. One for each ens member; 
- Name of a list-file containing the names of the restart files used as background initial states, saved at the time of the first observation. One for each ens member;
- Name of a list-file containing the names of the observation files;
- Name of a list-file containing the observation times in seconds in the same reference as the rst files.
- Dimension of the model state: nkn nel nlv
- Number of ensemble members: nrens
- 1 to create a new ens of initial states from one restart file (specify 
  restart file in the list and 1 skel-file). Use 0 to load nrens restart files.
  If it is set to 1 you must provide also a file named init_ens.info.
- 1 to use an augmented state with the model error. This option is advisable.
  If it is set to 1 you must provide also a file named mod_err.info.

----------
INIT_ENS.INFO, MOD_ERR.INFO
----------
The first file must contain a row with:
  - nx ny fmult theta sigma
The second file must contain a row with:
  - nx ny fmult theta sigma dt tau

  where:
  - nx,ny are the dimension of the grid of the pseudo random fields
  - fmult is the mult factor to create a supersample from the initial ensemble
  - theta is the rotation of the pseudo random fields (0 East, anticlockwise)
  - sigma is the standard deviation of the fields (level. Change the code to
    set different)
  - dt is the time between two observation steps (assumes regular intervals)
  - tau is the e-folding time of the model error

The values containted in the two files are indipendent. The first file is used
to create the initial ensemble, the second to propagate the model error by
using an augmented state.

----------
SKEL-FILE LIST
----------
A list of the skel-files. The first skel-file is the mean of the ensemble

----------
SKEL-FILES
----------
It is advisable to make the skel files using the str files used to produce the initial
background restart files. skel files must have these lines:
- in the "title" section put:
  Whatever title of sim
  NAMESIM
  BASIN
- in the "para" section put: 
  itrst = ITRST
  idtrst = IDTRST
  itanf = ITANF
  itend = ITEND
  nomp = NOMP 
- in the "name" section put:
  restrt = RESTRT

----------
RESTART LIST FILE
----------
A list of the initial restart files, sorted in the same way of the skel-files

----------
RESTART FILES
----------
They must contain just one state, saved at the time of the first observation. The
first restart file specified in the list is considered the control forecast, the
0 ensemble member. The list of restart files must be sorted as that of the skel files 
A possible way to make them is to run initial simulations ending at the first observation
time, varying the most uncertain forcings. Then save the final states in restart files
and list them.

----------
OBSERVATION LIST FILE
----------
A file with the list of the observation files

----------
TIME LIST FILE
----------
A file with the list of the observation times, in seconds

----------
OBSERVATION FILES
----------
These can be timeseries or transects/satellite tracks. Only the
records with times near the times in the list will be assimilated
(default delta t = 300 sec, see read_obs). The format is:
...
time obs_type(5 chars) x y z value stand_dev
time obs_type(5 chars) x y z value stand_dev
...

time = time in seconds
obs_type = specify only "level" at the moment
x, y, z = Coordinate of the observation, in the same reference system of the bas file. For level z = 0
value = value of the observation
stand_dev = standard deviation (estimated error) of the observation


-----------
UTILITY
-----------
merge_ens_output.sh:
extracts the ets or ext files, produced during the assimilation run, and merges 
them, creating one file for each ens member and each variable. The shy files 
are merged but, since they have two records at the same time in the analysis 
steps, they cannot be plotted with the current shyplot version.

randomize_var.sh:
creates n skel files from one, with a random value of a parameter. The right
and left limits for the values must be specified.


-----------
INSTALLATION NOTES
-----------
Compile the code with:

- cd enKF
- make cleanall
- make enkf_analysis

In order to run the enKF.sh script you need a small GNU program, named "parallel" and liblapack-dev.

Installation with Debian from root:
apt-get update && apt-get install parallel liblapack-dev

Installation with Ubuntu:
sudo apt-get update && apt-get install parallel liblapack-dev


